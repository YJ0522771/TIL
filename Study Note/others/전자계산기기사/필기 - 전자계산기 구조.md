# 전자계산기 구조

* 디지털 IC의 전달 지연시간 순서.
  * (短) `ECL - TTL - CMOS - MOS` (長)
  
* 명령어 내 bit 할당에 영향을 주는 요소.

  * 주소지정방식, 주소 영역, 연산코드

* **최대 병렬 수행도** (P) : 단위 시간에 처리할 수 있는 최대 비트 수.

  * 비트 슬라이스 : 연산 파이프라인 수 * 각 파이프라인의 단계 수.
  * `P = 비트 슬라이스 길이 * 단어 길이`

* CPI (cycle per instruction) = cycles / instruction

* `MIPS (Millions of instruction per second)`

  = instructions / seconds

  = `frequency (= cycles / seconds) / CPI`

#### 마이크로 명령(instruction) 형식

##### 수평 마이크로 명령

* instruction의 `하나의 bit`가 하나의 동작을 관할.
* micro operation부가 m비트일 때, m개의 동작을 표현.
* address부의 주소를 통해 다음 instruction의 주소를 결정.

##### 수직 마이크로 명령

* 제어 메모리 외부에서 디코딩 회로를 필요로 함.
* 하나의 instruction에 하나의 동작만을 제어.

##### 나노 명령

* 나노 메모리라는 낮은 레벨의 메모리에 저장된 instruction.
* 수직 마이크로 명령을 수행하는 제어기에서 디코더를 ROM(나노 메모리)로 대치하여 두 메모리 레벨로 구성.
* 제어 메모리의 각 word에는 나노 instruction이 저장되어 있는 나노 메모리의 번지들을 저장.



#### 인터럽트 (Interrupt)

##### 인터럽트 기능

* 컴퓨터가 정상적인 작엄을 수행하는 도중에 발생하는 예기치 않은 일들에 대한 서비스를 수행하는 기능.
* 온라인 실시간 처리를 위해 필수적.
* 입출력 인터럽트를 이용하면 중앙처리장치와 주변장치 간의 속도 차이 문제를 해결할 수 있음.

##### 인터럽트 전처리 루틴 (preprocessing routine)

* 인터럽트 불능 instruction을 수행하여, 모든 인터럽트 장치가 인터럽트를 요청하지 못하도록 함.

##### 우선순위 체제

* reference : https://devkim93.tistory.com/entry/%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8-%EC%9A%B4%EC%84%A0%EC%88%9C%EC%9C%84Priority-%EC%B2%B4%EC%A0%9C

* 동시 인터럽트 발생 시, 먼저 처리할 것을 결정.

* 전원 이상 - 기계 착오 - 외부 신호 - 입출력 - 명령어 잘못 - 프로그램 - SVC (supervisor check)

* 하드웨어 우선순위 인터럽트

  * vectored interrupt

* 소프트웨어 우선순위 인터럽트

  * polling

  |             | 하드웨어적 | 소프트웨어적 |
  | :---------: | :--------: | :----------: |
  |  반응 속도  |    고속    |     저속     |
  | 회로 복잡도 |    복잡    |     단순     |
  |   경제성    |  비경제적  |    경제적    |
  |   융통성    |    없음    |     있음     |

##### 인터럽트 발생 시 동작 순서

1. 인터럽트 요청 신호 발생.
2. 현재 수행 중인 프로그램의 상태를 저장.
3. 어느 장치가 인터럽트를 요청했는지 찾음.
4. 인터럽트 취급 루틴을 수행.
5. 보존한 프로그램 상태로 복귀.

##### 인터럽트 요청 시 처리 내용

* 중앙처리장치 : 인터럽트를 요구한 장치를 찾기 위해 입출력 장치를 폴링.
* PSW (program status word)에 현재 상태 보관.
* 인터럽트를 요구한 장치를 위한 인터럽트 서비스 프로그램 실행.
* 인터럽트 서비스 프로그램을 실행하는 중에도 다른 인터럽트를 처리할 수 있다.



#### 해밍 코드 (hamming code)

* reference : https://dreamlog.tistory.com/578
* 예 : 0101의 해밍 코드, 총 7 자리 (p1 p2 d1=0 p3 d2=1 d3=0 d4=1)
  * p1 = (1, 3, 5, 7)에서 첫 번째인 p1를 제외하고 XOR. = 0 xor 1 xor 1 = 0
  * p2 = (2, 3, 6, 7)에서 두 번째인 p2를 제외하고 XOR. = 0 xor 0 xor 1 = 1
  * p3 = (4, 5, 6, 7)에서 네 번째인 p3를 제외하고 XOR. = 1 xor 0 xor 1 = 0
  * 결과 : 0100101



#### 다중처리기 상호 연결 방법

* reference : https://smecsm.tistory.com/45

##### 시분할 공유 버스 (time shared single bus)

* 프로세서, 기억장치, 입출력장치 등 사이에 하나의 통신로를 이용하여 전송.
* 시스템이 간단.
* 전송률이 낮음.
* 경제적.
* bus에 이상이 생기면 전체 시스템이 가동 불능.

##### 크로스바 교환 행렬 (crossbar switch matrix)

* 공유 버스 시스템에서 버스의 수를 **기억장치 수만큼** 증가.
* 모든 기억장치에 대한 동시전송이 가능.
* 하드웨어 복잡.
* 전송률이 높음.
* 프로세서가 많은 경우 적합.

##### 하이퍼큐브 상호 연결망

* 많은 수의 처리를 비교적 경제적인 방법으로 연결.
* 다수의 프로세서를 연결할 수 있음.
* 확장성이 좋음.
* 하나의 프로세서에 연결되는 수가 n개일 떄, 프로세서는 총 2^n개가 필요.

##### 다중포트 메모리 (multiport storage)

* 크로스바 교환 행렬 + 시분할 공유 버스.
* 프로세서와 각 메모리 모듈 사이에 **각각의 버스**를 가짐.
* 하나의 프로세서에 하나의 버스가 할당. 
* 경쟁이 적음.
* 비교적 느림.
* 프로세서의 수가 적을 경우 적합.



#### 버스 중재

* reference : https://itstory07.tistory.com/880

* `버스 경합 (bus contention)` : 여러 버스 마스터들이 동시에 버스 사용을 요구.
* `버스 중재 (bus arbitration)` : 버스 경합 발생 시, 우선순위를 정해 버스 마스터들을 하나씩 골라냄.
* `버스 중재기 (bus arbiter)` : 버스를 중재하는 하드웨어 모듈.

##### 제어 신호들의 연결 구조에 따른 분류

* 병렬 중재 방식 (parallel arbitration scheme)
* 직렬 중재 방식 (serial arbitration scheme)

##### 버스 중재기의 위치에 따른 분류

* 중앙 집중식 중재 방식 (centralized arbitration scheme)
  * 시스템 내 중재기가 하나만 존재.
* 분산식 중재 방식 (decentralized arbitration scheme)
  * 여러 개의 버스 중재기 존재. 
  * 일반적으로 버스 마스터마다 중재기 하나.
  * 각 버스 마스터의 중재기에 의해 중재 동작이 이루어짐.

##### 우선순위 결정 방식에 따른 분류

* 고정 우선순위 방식 (fixed priority scheme)

* 가변 우선순위 방식 (dynamic priority scheme)

  * 모든 마스터들이 공정하게 버스 사용.
  * 중재 회로가 복잡.

  1. **회전 우선순위 (rotating priority)**
     * 중재 동작이 끝날 때마다 모든 마스터들의 우선순위가 하나씩 낮아짐. 가장 우선 순위가 낮았던 버스 마스터가 최상이 우선순위를 가지도록.
     * 버스 사용 승인을 받은 버스 마스터는 최하위 우선순위를 가지며, 바로 다음에 위치한 마스터가 최상위 우선순위를 가지도록 하는 방식.
  2. **임의 우선순위**
     * 버스 중재 동작이 끝날 때마다 우선순위를 임의로 결정.
  3. **동등 우선순위**
     * 모든 버스 마스터가 동일한 우선순위.
     * 먼저 요청한 마스터가 먼저 버스 사용 승인을 받음.
     * FIFO.
  4. **최소 최근 사용**
     * 가장 오랫동안 버스를 사용하지 않는 버스 마스터에 최상위 우선순위 할당.



#### 제어장치 구성 요소

* **순서 제어 모듈** : 명령어들의 실행 순서를 결정하는 회로들의 집합.
* **제어 기억장치** : 마이크로 프로그램을 저장하는 내부 기억장치.
* **제어 주소 레지스터 (CAR)** : 다음에 실행할 명령어의 주소를 저장.
* **서브루틴 레지스터 (SBR)** : 서브루틴이 호출되는 경우, 현재의 CAR 내용을 일시적으로 저장.
* **제어 버퍼 레지스터 (CBR)** : 명령어들의 비트들을 일시적으로 저장.
* **Instruction Decoder** : 명령어의 연산 코드를 해독하여 해당 연산을 수행하기 위한 루틴의 시작 주소 결정.

